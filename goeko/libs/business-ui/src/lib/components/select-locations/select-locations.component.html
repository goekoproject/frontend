<ng-container *ngTemplateOutlet="formSelectLocation"></ng-container>

@if(!newLocation || !toogleEdit) {
<div
  (click)="addLocation()"
  class="flex items-center justify-center h-16 border rounded-md border-dashed  border-primary-500 text-primary-500 text-4xl cursor-pointer"
>
  <i class="ti ti-plus"></i>
  <p class="text-base">{{ 'FORM_LABEL.newProvince' | translate }}</p>
</div>
}

<ng-template #formSelectLocation>
  <div class="select-profile" [formGroup]="form">
    <div formArrayName="locations" class="flex flex-col gap-1">
      @for(location of controlLocations.controls; track location; let i=$index){
      @if (location) {
      <div
        class="h-28"
        [class.hidden-selected]="toogleEdit && i === selectedLocationsIndex()"
      >
        <ng-container
          [ngTemplateOutlet]="readonly"
          [ngTemplateOutletContext]="{ location: location, index: i }"
        ></ng-container>
      </div>
      }

      <div
        [formGroupName]="i"
        [class.hidden-selected]="
          !(toogleEdit && i === selectedLocationsIndex())
        "
        class="locations-selected border-primary-500"
      >
        <div [formGroupName]="controlNameCountry">
          <ui-super-select
            [placeholder]="'SELECT_DATA_LABEL.defaultLabel' | translate"
            [formControlName]="'code'"
            [id]="controlNameCountry"
            [compareWith]="defaultSetSuperSelect"
            (valueChange)="onCodeChange($event.value)"
            [loadInit]="true"
          >
            <label title for="{{ controlNameCountry }}">
              {{ 'FORM_LABEL.country' | translate }}
            </label>
            <super-option *ngFor="let option of countries()" [value]="option">
              {{ option.label | translate }}
            </super-option>
          </ui-super-select>

          <div class="flex gap-4 items-center">
            <ui-super-select
              [placeholder]="'SELECT_DATA_LABEL.defaultLabel' | translate"
              [formControlName]="'regions'"
              [id]="controlNameProvince"
              [multiple]="true"
              [compareWith]="defaultSetSuperSelect"
              [loadInit]="true"
              [disabled]="isAllProvince"
            >
              <label title for="{{ controlNameProvince }}">
                {{ 'FORM_LABEL.province' | translate }}
              </label>
              <super-option *ngFor="let option of regions()" [value]="option">
                {{ option.label | translate }}
              </super-option>
            </ui-super-select>

            <div class="flex gap-1 items-center cursor-pointer">
              <input
                type="checkbox"
                id="allProvinces"
                name="allProvinces"
                [checked]="isAllProvince"
                (change)="getIsProvince($event.target)"
              />
              <label for="allProvinces">{{
                'FORM_LABEL.allProvinces' | translate
              }}</label>
            </div>
          </div>
        </div>
        <div class="m-auto flex gap-2 mr-0">
          <i
            [attr.disabled]="location.get(controlNameCountry)?.invalid"
            class="ti ti-circle-check-filled text-4xl cursor-pointer text-primary-500"
            (click)="confirmLocation(location)"
          ></i>
          <i
            class="ti ti-circle-x text-4xl cursor-pointer m-auto text-darkAccent"
            (click)="closeFormLocation(i)"
          >
          </i>
        </div>
      </div>
      }
    </div>
  </div>
</ng-template>
<ng-template #readonly let-location="location" let-index="index">
  @if(location) {
  <article
    class="locations-selected border-primary-500 text-primary-500 justify-around"
  >
    <section class="selected-element">
      <span class="title-elements">
        {{ 'FORM_LABEL.country' | translate }}</span
      >
      <p class="country">
        {{ location.get(controlNameCountry)?.value.code?.label }}
      </p>
    </section>

    <section class="selected-element basis-full">
      <span class="title-elements">
        {{ 'FORM_LABEL.province' | translate }}</span
      >

      <div class="selected-provinces">
        @if(location.get(controlNameCountry)?.value.regions) { @for ( provinces
        of location.get(controlNameCountry)?.value.regions; track
        provinces.code) {
        <p class="provinces bg-primary-300 text-darkAccent">
          {{ provinces.label }}
        </p>
        } } @else {
        <p class="provinces bg-primary-300 text-darkAccent">
          {{ 'FORM_LABEL.allProvinces' | translate }}
        </p>
        }
      </div>
    </section>
    <i
      class="ti ti-edit text-4xl m-auto cursor-pointer"
      (click)="editLocation(location, index)"
    ></i>
    <i
      class="ti ti-circle-x text-4xl cursor-pointer m-auto text-hp"
      (click)="deleteLocation(index)"
    >
    </i>
  </article>
  }
</ng-template>
